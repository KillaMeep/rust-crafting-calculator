<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Search</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1b1b1b; /* Dark background */
            color: #dcdcdc; /* Light text color */
        }
        h1 {
            color: #e2b057; /* Rust-inspired color */
        }
        label {
            margin-bottom: 10px;
            display: inline-block;
        }
        input[type="text"] {
            padding: 10px;
            width: calc(100% - 20px);
            border: 2px solid #e2b057; /* Rust-inspired border */
            border-radius: 5px;
            background-color: #2c2c2c; /* Darker input field */
            color: #dcdcdc;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #d8b24e; /* Lighter rust color on focus */
            transition: border-color 0.3s;
        }
        #autocomplete-list {
            border: 1px solid #e2b057; /* Rust border */
            z-index: 999;
            position: absolute;
            background-color: #2c2c2c; /* Darker background for suggestions */
            max-height: 200px;
            overflow-y: auto;
            width: calc(100% - 20px); /* Full width minus padding */
            opacity: 0; /* Initially hidden */
            transition: opacity 0.3s ease-in-out; /* Fade-in effect */
        }
        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            color: #dcdcdc; /* Text color */
            transition: background-color 0.3s;
        }
        .autocomplete-item:hover {
            background-color: #4c4c4c; /* Dark hover color */
        }
        #search-btn {
            background-color: #e2b057; /* Rust-inspired button color */
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
            color: #1b1b1b; /* Dark text */
            font-weight: bold;
            transition: background-color 0.3s;
        }
        #search-btn:hover {
            background-color: #d8b24e; /* Lighter rust on hover */
        }
        #item-info {
            margin-top: 20px;
            opacity: 0; /* Initially hidden */
            transition: opacity 0.3s ease-in-out; /* Fade-in effect */
        }
        #item-info.visible {
            opacity: 1; /* Show item info */
        }
    </style>
</head>
<body>

<h1>Item Search</h1>
<label for="item-name">Search for an Item:</label>
<input type="text" id="item-name" placeholder="Type item name..." autocomplete="off">
<div id="autocomplete-list"></div>
<button id="search-btn">Search</button>

<div id="item-info"></div>

<script>
// Check if we have cached item names
let itemNamesCache = JSON.parse(localStorage.getItem('itemNamesCache')) || [];

// Base API URL
const API_BASE_URL = 'https://api.rust.killameep.com';

// Function to fetch item names
async function fetchItemNames() {
    console.log('Fetching item names from the API...');
    try {
        const response = await fetch(`${API_BASE_URL}/get/allnames`);

        // Ensure we got a valid response
        if (!response.ok) {
            console.error(`HTTP error! status: ${response.status}`);
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Item names fetched successfully:', data);

        if (data.success && data.results) {
            // Extract names from results
            itemNamesCache = data.results.map(item => item.name); // Use name for autocompletion
            localStorage.setItem('itemNamesCache', JSON.stringify(itemNamesCache));
            console.log('Item names cached:', itemNamesCache);
        } else {
            console.error('Invalid data structure', data);
        }
    } catch (error) {
        console.error('Error fetching item names:', error);
    }
}

// Function to show autocomplete suggestions
function showAutocompleteSuggestions(value) {
    console.log('Showing autocomplete suggestions for:', value);
    const autocompleteList = document.getElementById('autocomplete-list');
    autocompleteList.innerHTML = ''; // Clear previous suggestions
    autocompleteList.style.opacity = 0; // Hide the list initially

    if (!value) return;

    const filteredNames = itemNamesCache.filter(name => name.toLowerCase().startsWith(value.toLowerCase()));
    console.log('Filtered item names:', filteredNames);

    filteredNames.forEach(name => {
        const item = document.createElement('div');
        item.classList.add('autocomplete-item');
        item.textContent = name;
        item.addEventListener('click', () => {
            document.getElementById('item-name').value = name;
            autocompleteList.innerHTML = ''; // Clear suggestions
            autocompleteList.style.opacity = 0; // Hide the list
            console.log('Selected item:', name);
        });
        autocompleteList.appendChild(item);
    });

    // Show the autocomplete list with fade-in
    if (filteredNames.length > 0) {
        autocompleteList.style.opacity = 1;
    }
}

// Function to fetch item details using the name
async function fetchItemDetails(name) {
    console.log('Fetching details for item:', name);
    try {
        const response = await fetch(`${API_BASE_URL}/get/bylongname/${encodeURIComponent(name)}`);

        // Ensure we got a valid response
        if (!response.ok) {
            console.error(`HTTP error! status: ${response.status}`);
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const itemInfo = await response.json();
        console.log('Item details fetched successfully:', itemInfo);
        displayItemInfo(itemInfo);
    } catch (error) {
        console.error('Error fetching item details:', error);
    }
}

// Function to display item information
function displayItemInfo(item) {
    console.log('Displaying item information:', item);
    const itemInfoDiv = document.getElementById('item-info');
    itemInfoDiv.innerHTML = `
        <h2>${item.name}</h2>
        <img src="${item.icon_path}" alt="${item.name}" style="width: 100px; height: 100px;">
        <p><strong>Category:</strong> ${item.category}</p>
        <p><strong>Blueprint:</strong> ${item.blueprint}</p>
        <p><strong>Ingredients:</strong> ${JSON.parse(item.ingredients).map(ing => `${ing.quantity}x ${ing.name}`).join(', ')}</p>
        <p><strong>Crafting Time:</strong> ${item.crafting_time}</p>
        <p><strong>Workbench Level:</strong> ${item.workbench_level}</p>
        <p><strong>Availability:</strong> ${item.availability}</p>
    `;
    itemInfoDiv.classList.add('visible'); // Add class to make it visible
}

// Event Listeners
document.getElementById('item-name').addEventListener('input', (e) => {
    console.log('Input event triggered:', e.target.value);
    showAutocompleteSuggestions(e.target.value);
});

document.getElementById('search-btn').addEventListener('click', () => {
    const name = document.getElementById('item-name').value;
    console.log('Search button clicked. Item name:', name);
    fetchItemDetails(name);
});

// Initial fetch for item names
if (itemNamesCache.length === 0) {
    fetchItemNames();
} else {
    console.log("Using cached item names");
}
</script>

</body>
</html>
